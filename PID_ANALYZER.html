<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>STM32 PRO SERVO MONITOR</title>    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>    <style>        * { box-sizing: border-box; }        body, html {            margin: 0; padding: 0;             width: 100%; height: 100vh;            background: #000;             color: #00FF00;            font-family: 'Segoe UI', sans-serif;            overflow: hidden;             display: flex;             justify-content: center;             align-items: center;        }        #app-wrapper {            width: 95vw;            height: 90vh;            background: #0a0a0a;            border: 1px solid #333;            display: flex;            flex-direction: column;            box-shadow: 0 0 20px rgba(0, 255, 0, 0.05);        }        #header {            flex-shrink: 0;             padding: 15px 25px;             background: #111;             border-bottom: 2px solid #333;            display: grid;            grid-template-columns: 1.2fr 2fr 1.2fr;            align-items: center;        }        /* Sekcja Loga i Diody */        .logo-section {            display: flex;            align-items: center;            gap: 15px;        }        .status-led {            width: 12px;            height: 12px;            border-radius: 50%;            background: #ff0000;            box-shadow: 0 0 10px #ff0000;            animation: pulse-red 2s infinite;        }        /* Dynamický nápis LIVE */        #live-text {            color: #444; /* Predvolene šedá */            transition: 0.5s;        }        /* Stav po pripojení */        .status-led.connected {            background: #00ff00;            box-shadow: 0 0 15px #00ff00;            animation: blink-green 0.5s infinite;        }        #live-text.active {            color: #00FF00;            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);        }        @keyframes pulse-red {            0% { opacity: 1; transform: scale(1); }            50% { opacity: 0.3; transform: scale(0.9); }            100% { opacity: 1; transform: scale(1); }        }        @keyframes blink-green {            0% { opacity: 1; filter: brightness(1.5); }            50% { opacity: 0.7; filter: brightness(1); }            100% { opacity: 1; filter: brightness(1.5); }        }        .scale-info {            font-size: 0.6rem;            color: #444;            letter-spacing: 2px;            margin-top: 2px;        }        #pid-display {            display: flex;            justify-content: center;            gap: 25px;            font-family: 'Courier New', monospace;            font-weight: bold;            color: #00FF00;            text-shadow: 0 0 10px rgba(0, 255, 0, 0.3);        }        .pid-box { text-align: center; }        .pid-label { font-size: 0.7rem; color: #888; display: block; margin-bottom: 2px; }        .pid-value { font-size: 1.4rem; }        #chart-container {             flex: 1;             width: 100%;             padding: 10px;            position: relative;         }        canvas { width: 100% !important; height: 100% !important; }        button {            background: transparent; border: 1px solid #00FF00; color: #00FF00; padding: 10px 20px;            font-weight: bold; cursor: pointer; transition: 0.3s;        }        button:hover { background: #00FF00; color: #000; box-shadow: 0 0 15px #00ff00; }                .pos-display { font-size: 1.2rem; font-family: monospace; color: #FF00FF; text-shadow: 0 0 8px rgba(255, 0, 255, 0.3); }    </style></head><body><div id="app-wrapper">    <div id="header">        <div class="logo-section">            <div>                <div style="font-size: 1.2rem; font-weight: bold; color: #888; line-height: 1;">                    STM32 <span id="live-text">LIVE</span>                </div>                <div class="scale-info">1:1 REALTIME</div>            </div>			<div id="led" class="status-led"></div>        </div>        <div id="pid-display">            <div class="pid-box"><span class="pid-label">P</span><span id="kp_val" class="pid-value">0.00</span></div>            <div class="pid-box"><span class="pid-label">I</span><span id="ki_val" class="pid-value">0.00</span></div>            <div class="pid-box"><span class="pid-label">D</span><span id="kd_val" class="pid-value">0.00</span></div>            <div class="pid-box" style="margin-left: 15px;"><span class="pid-label">SET</span><span id="set_val" class="pid-value">0</span></div>        </div>        <div style="display: flex; align-items: center; gap: 20px; justify-content: flex-end;">            <div class="pos-display">POS: <span id="angleValue">0</span>°</div>            <button id="connectBtn">CONNECT</button>        </div>    </div>    <div id="chart-container">        <canvas id="liveChart"></canvas>    </div></div><script>    const ctx = document.getElementById('liveChart').getContext('2d');    const led = document.getElementById('led');    const liveText = document.getElementById('live-text');    const connectBtn = document.getElementById('connectBtn');        const angleDisplay = document.getElementById('angleValue');    const kpDisplay = document.getElementById('kp_val');    const kiDisplay = document.getElementById('ki_val');    const kdDisplay = document.getElementById('kd_val');    const setDisplay = document.getElementById('set_val');    const MAX_POINTS = 200;    let dataBuffer = Array(MAX_POINTS).fill(90);    const chart = new Chart(ctx, {        type: 'line',        data: {            labels: Array(MAX_POINTS).fill(''),            datasets: [{                label: 'Pozycja Serwa',                data: dataBuffer,                borderColor: '#FF00FF',                borderWidth: 2,                pointRadius: 0,                tension: 0.1,                fill: false            }]        },        options: {            responsive: true,            maintainAspectRatio: false,             animation: false,            scales: {                y: {                    min: -40, max: 180,                     grid: { color: 'rgba(255, 255, 255, 0.05)' },                    ticks: { color: '#555', stepSize: 45 }                },                x: { display: false }            },            plugins: {                legend: { display: false },                annotation: {                    annotations: {                        line1: {                            type: 'line',                            yMin: 90, yMax: 90,                            borderColor: 'rgba(255, 255, 255, 0.1)',                            borderWidth: 1,                            borderDash: [5, 5]                        }                    }                }            }        }    });    let partialData = "";    connectBtn.onclick = async () => {        try {            const port = await navigator.serial.requestPort();            await port.open({ baudRate: 115200 });                        // Zmiana statusu UI na aktívny            led.classList.add('connected');            liveText.classList.add('active');            connectBtn.style.opacity = '0.3';            connectBtn.innerText = 'ONLINE';            const reader = port.readable.getReader();            const decoder = new TextDecoder();            while (true) {                const { value, done } = await reader.read();                if (done) break;                partialData += decoder.decode(value);                if (partialData.includes('\n')) {                    const lines = partialData.split('\n');                    partialData = lines.pop();                    for (const line of lines) {                        const parts = line.trim().split(',');                        if (parts.length >= 5) {                            const setpoint = parseFloat(parts[0]);                            const currentPos = parseFloat(parts[1]);                            const kp = parseFloat(parts[2]);                            const ki = parseFloat(parts[3]);                            const kd = parseFloat(parts[4]);                            dataBuffer.shift();                            dataBuffer.push(currentPos);                                                        angleDisplay.innerText = currentPos.toFixed(0);                            setDisplay.innerText = setpoint.toFixed(0);                            kpDisplay.innerText = kp.toFixed(2);                            kiDisplay.innerText = ki.toFixed(2);                            kdDisplay.innerText = kd.toFixed(2);                        }                    }                    chart.update('none');                 }            }        } catch (e) {            led.classList.remove('connected');            liveText.classList.remove('active');            alert("Serial Error: " + e.message);        }    };</script></body></html>